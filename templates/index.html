{% extends 'layout.html' %}
{% block title %}
    Index
{% endblock %}

{% block headline %}
    {{ title }}
{% endblock %}

{% block content %}

<!--vue.js container-->
<div id="app" class="m-3">
    <mycomp />
</div>


<!--mycomp's template-->
{% raw %}
<script type="text/x-template" id="mycomp-template">
<div>

<div class="alert alert-primary p-1">
    <h5>{{alert_msg}}</h5>
</div>

<!--パネルタブ-->
<ul class="nav nav-tabs" role="tablist">
    <li class="nav-item"><a href="#home" class="nav-link active" data-toggle="tab" role="tab">URL一括取得</a></li>
    <li class="nav-item"><a href="#second" class="nav-link" data-toggle="tab" role="tab">情報取得</a></li>
    <li class="nav-item"><a href="#thred" class="nav-link" data-toggle="tab" role="tab">在庫管理</a></li>
    <li class="nav-item"><a href="#fours" class="nav-link" data-toggle="tab" role="tab">お掃除</a></li>
</ul>

<!--パネルコンテンツ-->
<div class="tab-content">
    <!--一括取得パネルコンテンツ-->
    <div class="tab-pane fade show active" id="home" role="tabpanel">
        <!--一括取得のグループ-->
        <div class="form-group p-3">
            <h4>【URL一括取得】</h4>
            <label for="url">URL</label>
            <input type="text" id="url" name="url" class="form-control" placeholder="http://xxxxx@xxxx.com" v-model="post_url">
            <button v-on:click="postUrl" class="btn btn-primary col-3 col-sm-3 col-md-2 col-lg-2 col-xl-2">一括取得</button>
        </div>
    </div>

    <!--情報取得パネルコンテンツ-->
    <div class="tab-pane fade p-3" id="second" role="tabpanel">
        <!--情報取得のグループ-->
        <h4>【情報取得】</h4>
        <div class="form-row">
            <div class="form-group col">
                <label for="category">カテゴリ</label>
                <select type="text" id="category" name="category" class="form-control" placeholder="" v-model="post_category">
                    <option value="レディース">レディース</option>
                    <option value="メンズ">メンズ</option>
                    <option value="その他">その他</option>
                </select>
            </div>
            <div class="form-group col">
                <label for="deadline">購入期限</label>
                <input type="text" id="deadline" name="deadline" class="form-control" placeholder="yyyy/mm/dd" v-model="post_deadline">
            </div>
            <div class="form-group col">
                <label for="ratio">倍率</label>
                <input type="text" id="ratio" name="ratio" class="form-control" placeholder="???％(今はスルー)" v-model="post_ratio">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col">
                <label for="catchcopy">キャッチコピー</label>
                <input type="text" id="catchcopy" name="catchcopy" class="form-control" placeholder="【送料輸入税込】" v-model="post_catchcopy">
            </div>
            <div class="form-group col">
                <label for="overship">海外送料</label>
                <input type="text" id="overship" name="overship" class="form-control" placeholder="1234" v-model="post_overship">
            </div>
            <div class="form-group col">
                <label for="domship">国内送料</label>
                <input type="text" id="domship" name="domship" class="form-control" placeholder="6789" v-model="post_domship">
            </div>
        </div>
            <button v-on:click="getDescription" class="btn btn-primary col-3 col-sm-3 col-md-2 col-lg-2 col-xl-2">情報取得</button>
    </div>
    <!--在庫管理パネルコンテンツ-->
    <div class="tab-pane fade p-3" id="thred" role="tabpanel">
        <!--在庫管理のグループ-->
        <div class="form-group">
            <h4>【在庫削除】</h4>
            <label for="id">在庫ID</label>
            <input type="text" id="id" name="id" class="form-control" placeholder="1,2,3,4... or 123-456" v-model="post_id">
            <button v-on:click="delStock" class="btn btn-primary col-3 col-sm-3 col-md-2 col-lg-2 col-xl-2">在庫削除</button>
        </div>
        <br><br>
        <div class="form-group">
            <h4>【在庫確認】</h4>
            <label for="sid">在庫ID(スライスだから,在庫ID+1になる)</label>
            <input type="text" id="sid" name="sid" class="form-control" placeholder="0:100" v-model="stock_id">
            <button v-on:click="getStock" class="btn btn-primary">在庫確認</button>
        </div>
        <br><br>
        <h4>【BUYMA情報取得】BUYMAのIDとURLをDBに保存する</h4>
        <button v-on:click="getBuyma" class="btn btn-primary">BUYMA情報取得</button>
        <br><br>
        <h4>【BUYMA出品停止】在庫のない商品を出品停止中に変更する</h4>
        <button v-on:click="stopBuyma" class="btn btn-primary">BUYMA出品停止</button>
    </div>
    <!--お掃除パネルコンテンツ-->
    <div class="tab-pane fade p-3" id="fours" role="tabpanel">
        <!--お掃除のグループ-->
        <h4>【スプレッドシート削除】</h4>
        <button v-on:click="delSs" class="btn btn-primary" id="delete_spreadsheet">SP削除</button>
        <br><br>
        <h4>【商品画像フォルダ削除】</h4>
        <button v-on:click="delImg" class="btn btn-primary" id="delete_img_dir">画像削除</button>
    </div>
</div>
</div>
</script>
{% endraw %}


<!--Vue.js script-->
<script>
Vue.component('mycomp', {
    template: '#mycomp-template',
    data: function() {
        return {
            post_url: '',
            alert_msg: 'welcome to this new world !!',
            post_id: '',
            post_deadline: '',
            post_ratio: '',
            post_overship: '',
            post_domship: '',
            post_category: 'メンズ',
            post_catchcopy: '【送料輸入税込】',
            stock_id: ''
        }
    },
    methods:{
        // post_url
        postUrl: function() {
            this.alert_msg = '一括取得実行中です。けっこう時間かかります。しばらくお待ちください。';
            let formData = new FormData();
            formData.append("url", this.post_url);
            let self = this;
            $.ajax({
                type: 'POST',
                url: '/post',
                data: formData,
                processData: false,
                contentType: false,

                success: function(data) {
                    if(data != null){
                        self.post_url = '';
                        self.alert_msg = '終了しました！！';
                    }
                },
                error: function(request, status, err) {
                    self.alert_msg = 'URL送信時にエラーが発生しました。';
                }
            });
        },
        // get_description
        getDescription: function(){
            this.alert_msg = '商品情報取得実行中です。けっこう時間かかります。しばらくお待ちください。';
            let formData = new FormData();
            formData.append("deadline", this.post_deadline);
            formData.append("ratio", this.post_ratio);
            formData.append("overship", this.post_overship);
            formData.append("domship", this.post_domship);
            formData.append("category", this.post_category);
            formData.append("catchcopy", this.post_catchcopy);
            let self = this;
            $.ajax({
                type: 'POST',
                url: '/post_desc',
                data: formData,
                processData: false,
                contentType: false,

                success: function(data) {
                    if(data != null){
                        self.alert_msg = '終了しましたyo~~~！！';
                    }
                },
                error: function(request, status, err) {
                    self.alert_msg = 'URL送信時にエラーが発生しました。';
                }
            });
        },
        // delete_img
        delImg: function(){
            this.alert_msg = '商品情報取得実行中です。けっこう時間かかります。しばらくお待ちください。';
            let self = this;
            $.get("/del_img", function(data){
                if (data == 'True') {
                    self.alert_msg = '消えたよ笑';
                } else {
                    self.alert_msg = data;
                }
            });
        },
        // check_stock
        getStock: function(){
            this.alert_msg = '在庫確認実行中です。けっこう時間かかります。しばらくお待ちください。';
            let formData = new FormData();
            formData.append("sid", this.stock_id);
            let self = this;
            $.ajax({
                type: 'POST',
                url: '/get_stock',
                data: formData,
                processData: false,
                contentType: false,

                success: function(data) {
                    if(data != null){
                        self.check_id = '';
                        self.alert_msg = data;
                    }
                },
                error: function(request, status, err) {
                    self.alert_msg = 'URL送信時にエラーが発生しました。';
                }
            });
        },
        // delete_stock
        delStock: function(){
            this.alert_msg = '在庫削除実行中です。けっこう時間かかります。しばらくお待ちください。';
            let formData = new FormData();
            formData.append("id", this.post_id);
            let self = this;
            $.ajax({
                type: 'POST',
                url: '/del_stock',
                data: formData,
                processData: false,
                contentType: false,

                success: function(data) {
                    if(data != null){
                        self.post_id = '';
                        self.alert_msg = '終了しました！！';
                    }
                },
                error: function(request, status, err) {
                    self.alert_msg = 'URL送信時にエラーが発生しました。';
                }
            });
        },
        // check_stock
        delSs: function(){
            this.alert_msg = 'スプレッドシート削除中です。けっこう時間かかります。しばらくお待ちください。';
            let self = this;
            $.get("/del_ss", function(data){
                self.alert_msg = data
            });
        },
        // get_buyma
        getBuyma: function(){
            this.alert_msg = 'BUYMA情報取得中です。けっこう時間かかります。しばらくお待ちください。';
            let self = this;
            $.get("/get_bym", function(data){
                self.alert_msg = data
            });
        },
        stopBuyma: function(){
            this.alert_msg = 'BUYMA出品停止中です。けっこう時間かかります。しばらくお待ちください。';
            let self = this;
            $.get("/stop_bym", function(data){
                self.alert_msg = data
            });
        },
    },
});


// start Vue.
new Vue({
    el:'#app',
});
</script>
{% endblock %}

{% block footer %}
    copyright 2019 shuji
{% endblock %}